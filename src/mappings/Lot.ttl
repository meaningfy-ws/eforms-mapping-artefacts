#--- MG-Lot ---
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix locn: <http://www.w3.org/ns/locn#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix tedm: <http://data.europa.eu/a4g/mapping/sf-rml/> .
@prefix epd: <http://data.europa.eu/a4g/resource/> .
@prefix epo: <http://data.europa.eu/a4g/ontology#> .
@prefix epo-not: <http://data.europa.eu/a4g/ontology#>.
@prefix cv: <http://data.europa.eu/m8g/> .
@prefix cccev: <http://data.europa.eu/m8g/> .
@prefix org: <http://www.w3.org/ns/org#> .
@prefix cpov: <http://data.europa.eu/m8g/> .
@prefix	foaf: <http://xmlns.com/foaf/0.1/> .
@prefix time: <http://www.w3.org/2006/time#>.
@prefix adms: <http://www.w3.org/ns/adms#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix fnml:   <http://semweb.mmlab.be/ns/fnml#> .
@prefix fno: <https://w3id.org/function/ontology#> .
@prefix idlab-fn: <http://example.com/idlab/function/> .

tedm:MG-Lot_ND-Lot a rr:TriplesMap ;
    rdfs:label "MG-Lot" ;
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-Lot" ;
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_Lot_{cbc:ID}" ;
            rr:class epo:Lot
        ]  ;

    rr:predicateObjectMap
        [
            rdfs:label "BT-767-Lot,and BT-122-Lot ";
            rr:predicate epo:usesTechnique ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-EAuctionTechnique-usesTechnique-Lot_ND-AuctionTerms ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-766-Lot ";
            rr:predicate epo:usesTechnique ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-DynamicPurchaseSystemTechnique-usesTechnique-Lot_ND-LotTenderingProcess ;
                    rr:joinCondition [
                       rr:child "path(.)";
                         rr:parent "path(../.)";
                    ];
                ] ;
        ] ;
     rr:predicateObjectMap
        [
            rdfs:label "BT-123-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-AuctionTerms ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
      rr:predicateObjectMap
        [
            rdfs:label "BT-63-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-LotTenderingTerms ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(..)";
                    ];
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-765-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-FrameworkAgreementTerm-isSubjectToLotSpecificTerm-Lot_ND-LotTenderingProcess ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(..)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-113-Lot, BT-109-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-FrameworkAgreementTerm-isSubjectToLotSpecificTerm-Lot_ND-FA  ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-111-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-FrameworkAgreementTerm-isSubjectToLotSpecificTerm-Lot_ND-FABuyerCategories  ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-52-Lot, BT-130-Lot, BT-631-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-MultipleStageProcedureTerm-isSubjectToLotSpecificTerm-Lot_ND-LotTenderingProcess  ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-51-Lot and BT-50-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-MultipleStageProcedureTerm-isSubjectToLotSpecificTerm-Lot_ND-SecondStage ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-131(d)-Lot and BT-131(t)-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-SubmissionDeadline ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-13(d)-Lot and BT-13(t)-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-AccessTerm-isSubjectToLotSpecificTerm-Lot_ND-LotInfoRequestPeriod ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-1311(d)-Lot and BT-1311(t)-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-ParticipationRequestPeriod ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-134-Lot, BT-132(d)-Lot, BT-132(t)-Lot and BT-133-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-OpeningTerm-isSubjectToLotSpecificTerm-Lot_ND-PublicOpening ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-133-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Address-definesOpeningPlace-OpeningTerm-isSubjectToLotSpecificTerm-Lot_ND-PublicOpeningPlace;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-17-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-LotTenderingProcess;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../.)";
                    ];
                ] ;
        ];
      rr:predicateObjectMap
        [
            rdfs:label "BT-44-Lot, BT-644-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-DesignContestRegimeTerm-isSubjectToLotSpecificTerm-Lot_ND-AwardingTerms;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../..)";
                    ];
                ] ;
        ];
      rr:predicateObjectMap
        [
            rdfs:label "BT-771-Lot, BT-772-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-LateTendererInformation;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../..)";
                    ];
                ] ;
        ];
#    rr:predicateObjectMap
#        [
#            rdfs:label "BT-45-Lot";
#            rr:predicate epo:isSubjectToLotSpecificTerm ;
#            rr:objectMap
#                [
#                    rr:parentTriplesMap tedm:MG-DesignContestRegimeTerm-isSubjectToLotSpecificTerm-Lot_ND-Prize;
#                    rr:joinCondition [
#                        rr:child "path(.)";
#                        rr:parent "path(../..)";
#                    ];
#                ] ;
#        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-124-Lot";
        rr:predicate epo:usesChannel ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-AdHocChannel-usesChannel-Lot_ND-LotTenderingProcess;
                    rr:joinCondition [
                         rr:child "cbc:ID";
                        rr:parent "../cbc:ID";
                    ];
                ] ;
        ];
         rr:predicateObjectMap
        [
            rdfs:label "BT-632-Lot";
        rr:predicate epo:usesChannel ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-AdHocChannel-usesChannel-Lot_ND-LotTenderingProcessExtension;
                    rr:joinCondition [
                        rr:child "cbc:ID";
                        rr:parent "../cbc:ID";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-137-Lot" ;
            rdfs:comment "Purpose Lot Identifier of MG-Lot under ND-Lot" ;
            rr:predicate adms:identifier ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Identifier-identifier-Lot_ND-Lot ;
                ] ;
        ];
     rr:predicateObjectMap
        [
            rdfs:label "BT-60-Lot";
            rr:predicate epo:isUsingEUFunds  ;
            rr:objectMap
                [
                    rml:reference "cac:TenderingTerms/cbc:FundingProgramCode[@listName='eu-funded']";
                    rr:datatype xsd:boolean
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-7220-Lot and BT-5010-Lot";
            rr:predicate epo:isFundedBy ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Fund-isFundedBy-Lot_ND-Funding;
                    rr:joinCondition [
                        rr:child "cbc:ID";
                        rr:parent "../../../../../../cbc:ID";
                    ];
                ] ;
        ];
#      rr:predicateObjectMap
#        [
#            # TODO min SDK 1.9.1
#            rdfs:label "BT-5010-Lot";
#            rdfs:comment "EUFundsFinancingIdentifier of MG-Identifierunder ND-Funding";
#            rr:predicate epo:isFundedBy ;
#            rr:objectMap
#                [
#
#                    rr:parentTriplesMap tedm:MG-Fund-isFundedBy-Lot_ND-Funding;
##                    rr:joinCondition [
##                        rr:child "cbc:ID";
##                        rr:parent "../../../../../../cbc:ID";
##                    ];
#                ] ;
#        ] ;
   rr:predicateObjectMap
        [
            rdfs:label "BT-747-Lot, BT-749-Lot, BT-748-Lot, BT-40-Lot and BT-750-Lot ";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SelectionCriteria;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../../../../..)";
                    ];
                ] ;
        ];
#    rr:predicateObjectMap
#        [
#            rdfs:label "BT-7531-Lot";
#            rr:predicate epo:specifiesProcurementCriterion;
#            rr:objectMap
#                [
#                    rr:parentTriplesMap tedm:MG-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SelectionCriteria ;
#                    rr:joinCondition [
#                        rr:child "path(.)";
#                        rr:parent "path(../../../../../../..)";
#                    ];
#                ] ;
#        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-7532-Lot";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SelectionCriteria ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../../../../..)";
                    ];
                ] ;
        ];
        rr:predicateObjectMap
        [
            rdfs:label "BT-752-Lot-WeightNumber";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SecondStageWeightCriterionParameter ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../../../../../..)";
                    ];
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-539-Lot, BT-540-Lot and BT-734-Lot";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardCriterion ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../../..)";
                    ];
                ] ;
        ];
   rr:predicateObjectMap
        [
            rdfs:label "BT-5421 and BT-541";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardWeightCriterionParameter;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../../../../../../../..)";
                    ];
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-5422-Lot and BT-541-Lot-FixedNumber";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardWeightCriterionParameter;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../../../../../../../..)";
                    ];
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-543-Lot";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardCriteria;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../..)";
                    ];
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-71-Lot";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    #TODO fix the joint  condition path
                    rr:parentTriplesMap tedm:MG-ParticipationCondition-specifiesProcurementCriterion-Lot_ND-LotReservedParticipation;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../../../..)";
                    ];
                ] ;
        ];
 rr:predicateObjectMap
        [
           # TODO fix the path
            rdfs:label "BT-733-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-AwardEvaluationTerm-isSubjectToLotSpecificTerm-Lot_ND-LotAwardCriteria ;
                    rr:joinCondition[
                        rr:child "path(.)";
                        rr:parent "path(../../../..)";
                    ];
                ] ;
        ] ;
     rr:predicateObjectMap
        [
            rdfs:label "BT-120-Lot";
            rr:predicate epo:specifiesProcurementCriterion;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-MultipleStageProcedureTerm-isSubjectToLotSpecificTerm-Lot_ND-AwardingTerms;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../..)";
                    ];
                ] ;
        ];
      rr:predicateObjectMap
        [
            rdfs:label "BT-76-Lot";
            rr:predicate epo:foreseesContractSpecificTerm;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-ContractTerm-foreseesContractSpecificTerm-Lot_ND-TendererLegalForm;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(../..)";
                    ];
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-17-Lot";
            rr:predicate epo:isSubjectToLotSpecificTerm ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-DesignContestRegimeTerm-isSubjectToLotSpecificTerm-Lot_ND-AwardingTerms;
                   # TODO fix the path
#                    rr:joinCondition [
#                         rr:child "path(.)";
#                        rr:parent "path(../../..)";
#                    ];
                ] ;
        ];
.

tedm:MG-Identifier-identifier-Lot_ND-Lot a rr:TriplesMap ;
    rdfs:label "BT-137-Lot";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rml:reference "if (exists(cbc:ID)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_LotIdentifier_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
            rr:class adms:Identifier
        ] ;
    rr:predicateObjectMap
        [

            rr:predicate skos:notation ;
            rr:objectMap
                [
                    rml:reference "cbc:ID";
                ] ;
        ];
     rr:predicateObjectMap
        [
            rdfs:label "BT-137-Lot-Scheme" ;
            rdfs:comment "Scheme of MG-Identifier under ND-Lot" ;
            rr:predicate epo:hasScheme ;
            rr:objectMap
                [
                    rml:reference "cbc:ID/@schemeName";
                ] ;
        ] ;
.

# this is an example of a linked resource that is instantiated on an iterator that repeats, but for a parent resource that does not
tedm:MG-Identifier-identifier-PlanningNotice-refersToPrevious-Notice_ND-LotPreviousPlanning a rr:TriplesMap ;
    rdfs:label "MG-Identifier";
   rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:NoticeDocumentReference";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotPreviousPlanning";
            # this is an example of an IRI component hashing on an explicit element to prevent unwanted instances (owing to an iterator that has repeating elements)
            rml:reference "if (exists(cbc:ID)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(cbc:ID, ' ', '-' ), '/' , '-') || '_PlanningNoticeIdentifier_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(cbc:ID) || '?response_type=raw') else null" ;
            rr:class adms:Identifier
        ] ;
    rr:predicateObjectMap
        [
            # TODO link to LOt (In CM no link)
            rdfs:label "BT-125(i)-Lot";
            rdfs:comment "Previous Planning Identifier of MG-Identifier under ND-LotPreviousPlanning";
            rr:predicate skos:notation ;
            rr:objectMap
                [
                    rml:reference "cbc:ID";
                ] ;
        ];

#   rr:predicateObjectMap
#        [
#            rdfs:label "BT-125(i)-Lot-Scheme" ;
#            rdfs:comment "Scheme of MG-Identifier under ND-LotPreviousPlanning" ;
#            rr:predicate epo:hasScheme ;
#            rr:objectMap
#                [
#                    rml:reference "cbc:ID/@schemeName";
#                ] ;
#        ] ;
.

# this is an example of an external root resource (Notice) instantiation for referencing
tedm:MG-PlanningNotice-refersToPrevious-Notice_ND-LotPreviousPlanning a rr:TriplesMap ;
    rdfs:label "MG-PlanningNotice";
   rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:NoticeDocumentReference";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotPreviousPlanning";
            # we use the ID at this level to create an IRI with the pattern of a Notice
            rml:reference "if (exists(cbc:ID)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(cbc:ID, ' ', '-' ), '/' , '-') || '_Notice' else null" ;
            rr:class epo:PlanningNotice
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-125(i)-Lot";
            rdfs:comment "Previous Planning Identifier of MG-PlanningNotice under ND-LotPreviousPlanning ";
            rr:predicate adms:identifier ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Identifier-identifier-PlanningNotice-refersToPrevious-Notice_ND-LotPreviousPlanning ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(.)";
                    ];
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            # TODO link to LOt (In CM no link)
            rdfs:label "BT-1251-Lot";
            rdfs:comment "Previous Planning Part Identifier of MG-PlanningNotice under ND-LotPreviousPlanning ";
            rr:predicate epo:announcesPlannedProcurementPart ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-PlannedProcurementPart-announcesPlannedProcurementPart-PlanningNotice-refersToPrevious-Notice_ND-LotPreviousPlanning;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(.)";
                    ];
                ] ;
        ]
.

tedm:MG-Notice_ND-LotPreviousPlanning a rr:TriplesMap ;
    rdfs:label "MG-Notice";
   rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:NoticeDocumentReference";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotPreviousPlanning";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_Notice" ;
            # rml:reference "if (exists(cbc:ID)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_PlanningNotice_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
            rr:class epo:Notice
        ] ;
    rr:predicateObjectMap
        [
           # TODO link to LOt (In CM no link)
            rdfs:label "BT-125(i)-Lot and BT-1251-Lot";
            rdfs:comment "Previous Planning Identifier of MG-Notice under ND-LotPreviousPlanning ";
            rr:predicate epo:refersToPrevious ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-PlanningNotice-refersToPrevious-Notice_ND-LotPreviousPlanning ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(.)";
                    ];
                ] ;
        ] ;
.

# this is an example of a second-degree linked resource of a linked external resource
tedm:MG-Identifier-identifier-PlannedProcurementPart-announcesPlannedProcurementPart-PlanningNotice-refersToPrevious-Notice_ND-LotPreviousPlanning a rr:TriplesMap ;
    rdfs:label "MG-Identifier";
   rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:NoticeDocumentReference";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotPreviousPlanning";
            # we hash on the ID instead as it is bound to be unique (this internal address is not)
            rml:reference "if (exists(cbc:ReferencedDocumentInternalAddress)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(cbc:ID, ' ', '-' ), '/' , '-') || '_PlannedProcurementPartIdentifier_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(cbc:ID) || '?response_type=raw') else null" ;
            rr:class adms:Identifier
        ] ;
    rr:predicateObjectMap
        [
            # TODO link to LOt (In CM no link)
            rdfs:label "BT-1251-Lot";
            rdfs:comment "Previous Planning Part Identifier of MG-Identifier under ND-LotPreviousPlanning ";
            rr:predicate skos:notation ;
            rr:objectMap
                [
                    rml:reference "cbc:ReferencedDocumentInternalAddress";
                ] ;
        ]
.

# this is an example of a linked resource of a linked external resource
tedm:MG-PlannedProcurementPart-announcesPlannedProcurementPart-PlanningNotice-refersToPrevious-Notice_ND-LotPreviousPlanning a rr:TriplesMap ;
    rdfs:label "MG-PlannedProcurementPart";
   rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:NoticeDocumentReference";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotPreviousPlanning";
            rml:reference "if (exists(cbc:ReferencedDocumentInternalAddress)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(cbc:ID, ' ', '-' ), '/' , '-') || '_PlannedProcurementPart_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(cbc:ID) || '?response_type=raw') else null" ;
            rr:class epo:PlannedProcurementPart
        ] ;
    rr:predicateObjectMap
        [
            # TODO link to LOt (In CM no link)
            rdfs:label "BT-1251-Lot";
            rdfs:comment "Previous Planning Part Identifier of MG-PlannedProcurementPart under ND-LotPreviousPlanning ";
            rr:predicate adms:identifier ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Identifier-identifier-PlannedProcurementPart-announcesPlannedProcurementPart-PlanningNotice-refersToPrevious-Notice_ND-LotPreviousPlanning ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(.)";
                    ];
                ] ;
        ]
.

tedm:MG-EAuctionTechnique-usesTechnique-Lot_ND-AuctionTerms a rr:TriplesMap ;
    rdfs:label "MG-EAuctionTechnique";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:AuctionTerms";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-AuctionTerms";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_AuctionTerms_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw')}" ;
            rr:class epo:EAuctionTechniqueUsage
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-767-Lot";
            rdfs:comment "Electronic Auction of MG-EAuctionTechnique under ND-AuctionTerms ";
            rr:predicate  epo:hasUsage ;
            rr:objectMap
                [
                    rdfs:label "at-voc:usage";
                    rdfs:comment "translation of 'true' to at-voc:usage:used";
                    rml:reference "if(cbc:AuctionConstraintIndicator/text()='true') then 'http://publications.europa.eu/resource/authority/usage/used' else null";
                    rr:termType rr:IRI
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-122-Lot";
            rdfs:comment "Electronic Auction Description of MG-EAuctionTechnique under ND-AuctionTerms ";
            rr:predicate dct:description;
            rr:objectMap
                [
                    rml:reference "cbc:Description";
                ] ;
        ]
.

tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-AuctionTerms a rr:TriplesMap ;
    rdfs:label "MG-SubmissionTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:AuctionTerms";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-AuctionTerms";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SubmissionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw')}" ;
            rr:class epo:SubmissionTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-123-Lot";
            rdfs:comment "Electronic Auction URL of MG-SubmissionTerm under ND-AuctionTerms ";
            rr:predicate epo:hasEAuctionURL ;
            rr:objectMap
                [
                    rml:reference "cbc:AuctionURI";
                    rr:datatype xsd:anyURI
                ] ;
        ]
.

tedm:MG-Lot_ND-LotTenderingProcess a rr:TriplesMap ;
    rdfs:label "MG-Lot";
    rml:logicalSource
        [
           rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotTenderingProcess";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_Lot_{cbc:ID}" ;
            rr:class epo:Lot
        ] ;
 rr:predicateObjectMap
        [
            rdfs:label "BT-115-Lot";
            rdfs:comment "GPA Coverage of MG-Lot under ND-LotTenderingProcess";
            rr:predicate epo:isCoveredByGPA  ;
            rr:objectMap
                [
                    rml:reference "cac:TenderingProcess/cbc:GovernmentAgreementConstraintIndicator";
                    rr:datatype xsd:boolean
                ] ;
        ]
.

tedm:MG-FrameworkAgreementTerm-isSubjectToLotSpecificTerm-Lot_ND-LotTenderingProcess a rr:TriplesMap ;
    rdfs:label "MG-FrameworkAgreementTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotTenderingProcess";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_FrameworkAgreementTechnicalUsage_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw')}" ;
            rr:class  epo:FrameworkAgreementTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-765-Lot";
            # TODO min SDK 1.3 max SDK 1.8
            #  TODO min SDK 1.9.1
            rdfs:comment "Framework Agreement of MG-FrameworkAgreementTerm under ND-LotTenderingProcess ";
            rr:predicate epo:hasFrameworkAgreementType ;
            rr:objectMap
                [
                    rdfs:label "at-voc:framework-agreement" ;
                    rr:parentTriplesMap tedm:framework-agreement ;
                    rr:joinCondition [
                        rr:child "cac:ContractingSystem/cbc:ContractingSystemTypeCode[@listName='framework-agreement']";
                        rr:parent "code.value" ;
                    ] ;
#                    rml:reference "cac:ContractingSystem/cbc:ContractingSystemTypeCode[@listName='framework-agreement']";
                ] ;

        ]
.

tedm:MG-DynamicPurchaseSystemTechnique-usesTechnique-Lot_ND-LotTenderingProcess a rr:TriplesMap ;
    rdfs:label "MG-DynamicPurchaseSystemTechnique";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotTenderingProcess";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_DynamicPurchaseSystemTechnicalUsage_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw')}" ;
            rr:class epo:DynamicPurchaseSystemTechnique
        ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.3 max SDK 1.8
            #  TODO min SDK 1.9.1
            rdfs:label "BT-766-Lot";
            rdfs:comment "Dynamic Purchasing System of MG-DynamicPurchaseSystemTechnique under ND-LotTenderingProcess";
            rr:predicate epo:hasDPSScope ;
            rr:objectMap
                [
                    rdfs:label "at-voc:dps-usage" ;
                    rr:parentTriplesMap tedm:fdps-usage ;
                    rr:joinCondition [
                        rr:child "cac:ContractingSystem/cbc:ContractingSystemTypeCode[@listName='dps-usage']";
                        rr:parent "code.value" ;
                    ] ;
#                    rml:reference "cac:ContractingSystem/cbc:ContractingSystemTypeCode[@listName='dps-usage']";
                ] ;
        ]
.
tedm:MG-FrameworkAgreementTerm-isSubjectToLotSpecificTerm-Lot_ND-FA a rr:TriplesMap ;
    rdfs:label "MG-FrameworkAgreementTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:FrameworkAgreement";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-FA";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_FrameworkAgreementTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw')}" ;
            rr:class epo:FrameworkAgreementTerm
        ] ;
    rr:predicateObjectMap
        [

            rdfs:label "BT-113-Lot";
            rdfs:comment "Framework Maximum Participants Number of MG-FrameworkAgreementTerm under ND-FA";
            rr:predicate epo:hasMaximumParticipantsNumber ;
            rr:objectMap
                [
                    rml:reference "cbc:MaximumOperatorQuantity";
                    rr:datatype xsd:integer;
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-109-Lot";
            rdfs:comment "Framework Duration Justification of MG-FrameworkAgreementTerm under ND-FA";
            rr:predicate epo:hasDurationExtensionJustification ;
            rr:objectMap
                [
                    rml:reference "cbc:Justification";
                ] ;
        ]
.
tedm:MG-FrameworkAgreementTerm-isSubjectToLotSpecificTerm-Lot_ND-FABuyerCategories a rr:TriplesMap ;
    rdfs:label "MG-FrameworkAgreementTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:FrameworkAgreement/cac:SubsequentProcessTenderRequirement[cbc:Name/text()='buyer-categories']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-FABuyerCategories";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_FrameworkAgreementTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:FrameworkAgreementTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-111-Lot";
            rdfs:comment "Framework Buyer Categories of MG-FrameworkAgreementTerm under ND-FABuyerCategories";
            rr:predicate epo:hasBuyerCategoryDescription ;
            rr:objectMap
                [
                    rml:reference "cbc:Description";
                ] ;
        ]
.

tedm:MG-MultipleStageProcedureTerm-isSubjectToLotSpecificTerm-Lot_ND-LotTenderingProcess a rr:TriplesMap ;
    rdfs:label "MG-MultipleStageProcedureTerm";
    rdfs:comment "different from old mapping";
    rml:logicalSource
        [
             rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:EconomicOperatorShortList";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotTenderingProcess";
            rml:reference "if (exists(cbc:CandidateReductionConstraintIndicator) or exists(descendant::cbc:LimitationDescription) or exists(descendant::cbc:MaximumQuantity) or exists(descendant::cbc:MinimumQuantity)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_MultipleStageProcedureTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw') else null" ;
            rr:class  epo:MultipleStageProcedureTerm
        ] ;
 rr:predicateObjectMap
        [
            rdfs:label "BT-52-Lot";
            rdfs:comment "Successive Reduction Indicator (Lot) of MG-MultipleStageProcedureTerm under ND-LotTenderingProcess";
            rr:predicate epo:hasSuccessiveReduction ;
            rr:objectMap
                [
                    rml:reference "../cbc:CandidateReductionConstraintIndicator";
                    rr:datatype xsd:boolean
                ] ;
        ];
rr:predicateObjectMap
        [
            rdfs:label "BT-130-Lot";
            rdfs:comment "Dispatch Invitation Tender of MG-MultipleStageProcedureTerm under ND-LotTenderingProcess";
            rr:predicate epo:hasEstimatedInvitationToTenderDate ;
            rr:objectMap
                [
                    rml:reference "../cac:InvitationSubmissionPeriod/cbc:StartDate";
                    rr:datatype xsd:date;
                ] ;
        ];
rr:predicateObjectMap
        [
            rdfs:label "BT-631-Lot";
            rdfs:comment "Dispatch Invitation Interest of MG-MultipleStageProcedureTerm under ND-LotTenderingProcess";
            rr:predicate epo:hasEstimatedInvitationToExpressInterestDate ;
            rr:objectMap
                [
                    rml:reference "../cac:ParticipationInvitationPeriod/cbc:StartDate";
                    rr:datatype xsd:date;
                ] ;
        ]
.
tedm:MG-MultipleStageProcedureTerm-isSubjectToLotSpecificTerm-Lot_ND-SecondStage a rr:TriplesMap ;
    rdfs:label "MG-MultipleStageProcedureTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:EconomicOperatorShortList";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-SecondStage";
            rml:reference "if (exists(cbc:CandidateReductionConstraintIndicator) or exists(descendant::cbc:LimitationDescription) or exists(descendant::cbc:MaximumQuantity) or exists(descendant::cbc:MinimumQuantity)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_MultipleStageProcedureTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw') else null" ;
            rr:class epo:MultipleStageProcedureTerm
        ] ;

    rr:predicateObjectMap
        [
            rdfs:label "BT-51-Lot";
            rdfs:comment "Maximum Candidates Number of MG-MultipleStageProcedureTerm under ND-SecondStage";
            rr:predicate epo:hasMaximumNumberOfCandidates ;
            rr:objectMap
                [
                    rml:reference "cbc:MaximumQuantity";
                    rr:datatype xsd:integer
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-50-Lot";
            rdfs:label "Minimum Candidates of MG-MultipleStageProcedureTerm under ND-SecondStage";
            rr:predicate epo:hasMinimumNumberOfCandidates ;
            rr:objectMap
                [
                    rml:reference "cbc:MinimumQuantity";
                                  ] ;
        ]

.

tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-SubmissionDeadline a rr:TriplesMap ;
    rdfs:label "MG-SubmissionTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:TenderSubmissionDeadlinePeriod";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-SubmissionDeadline";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SubmissionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw')}" ;
            rr:class epo:SubmissionTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-131(d)-Lot";
            rdfs:comment "Deadline Receipt Tenders of MG-SubmissionTerm under ND-SubmissionDeadline";
            rr:predicate epo:hasReceiptTenderDeadline ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:EndDate) and exists(cbc:EndTime)) then cbc:EndDate || 'T' || cbc:EndTime else if(exists(cbc:EndDate)) then cbc:EndDate else null";
                    rr:datatype xsd:dateTime;
                ] ;
        ];
 rr:predicateObjectMap
        [
            rdfs:label "BT-131(t)-Lot";
            rdfs:comment "Deadline Receipt Tenders of MG-SubmissionTerm under ND-SubmissionDeadline";
            rr:predicate epo:hasReceiptTenderDeadline ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:EndDate) and exists(cbc:EndTime)) then cbc:EndDate || 'T' || cbc:EndTime else if(exists(cbc:EndDate)) then cbc:EndDate else null";
                    rr:datatype xsd:dateTime;
                ] ;
        ]
.

tedm:MG-AccessTerm-isSubjectToLotSpecificTerm-Lot_ND-LotInfoRequestPeriod a rr:TriplesMap ;
    rdfs:label "MG-AccessTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:AdditionalInformationRequestPeriod";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
             rdfs:label "ND-LotInfoRequestPeriod";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_AccessTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw')}" ;
            rr:class  epo:AccessTerm
        ]   ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-13(d)-Lot";
            rdfs:comment "Additional Information Deadline of MG-AccessTerm under ND-LotInfoRequestPeriod";
            rr:predicate epo:hasAdditionalInformationDeadline ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:EndDate) and exists(cbc:EndTime)) then cbc:EndDate || 'T' || cbc:EndTime else if(exists(cbc:EndDate)) then cbc:EndDate else null";
                ] ;
        ];
rr:predicateObjectMap
        [
            rdfs:label "BT-13(t)-Lot";
            rdfs:comment "Additional Information Deadline of MG-AccessTerm under ND-LotInfoRequestPeriod";
            rr:predicate epo:hasAdditionalInformationDeadline ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:EndDate) and exists(cbc:EndTime)) then cbc:EndDate || 'T' || cbc:EndTime else if(exists(cbc:EndDate)) then cbc:EndDate else null";
                                  ] ;
        ]
.

tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-ParticipationRequestPeriod a rr:TriplesMap ;
    rdfs:label "MG-SubmissionTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:ParticipationRequestReceptionPeriod";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-ParticipationRequestPeriod";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SubmissionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw')}" ;
            rr:class epo:SubmissionTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-1311(d)-Lot";
            rdfs:comment "Deadline Receipt Requests of under ND-ParticipationRequestPeriod";
            rr:predicate epo:hasReceiptParticipationRequestDeadline ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:EndDate) and exists(cbc:EndTime)) then cbc:EndDate || 'T' || cbc:EndTime else if(exists(cbc:EndDate)) then cbc:EndDate else null";
                    rr:datatype xsd:dateTime;
                ] ;
        ];
rr:predicateObjectMap
        [
            rdfs:label "BT-1311(t)-Lot";
            rdfs:comment "Deadline Receipt Requests of under ND-ParticipationRequestPeriod";
            rr:predicate epo:hasReceiptParticipationRequestDeadline ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:EndDate) and exists(cbc:EndTime)) then cbc:EndDate || 'T' || cbc:EndTime else if(exists(cbc:EndDate)) then cbc:EndDate else null";
                    rr:datatype xsd:dateTime;
                ] ;
        ]
.

tedm:MG-OpeningTerm-isSubjectToLotSpecificTerm-Lot_ND-PublicOpening a rr:TriplesMap ;
    rdfs:label "MG-OpeningTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:OpenTenderEvent";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-PublicOpening";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_OpeningTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw')}" ;
            rr:class  epo:OpeningTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-134-Lot";
            rdfs:comment "Public Opening Description of MG-OpeningTerm under ND-PublicOpening";
            rr:predicate epo:hasOpeningDescription ;
            rr:objectMap
                [

                    rml:reference "cbc:Description";
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-132(d)-Lot";
            rdfs:comment "Public Opening Date of MG-OpeningTerm under ND-PublicOpening";
            rr:predicate epo:hasOpeningDateTime ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:OccurrenceDate) and exists(cbc:OccurrenceTime)) then cbc:OccurrenceDate || 'T' || cbc:OccurrenceTime else if(exists(cbc:OccurrenceDate)) then cbc:OccurrenceDate else null";
                    rr:datatype xsd:dateTime;
                ] ;
        ] ;
rr:predicateObjectMap
        [
            rdfs:label "BT-132(t)-Lot";
            rdfs:comment "Public Opening Date of MG-OpeningTerm under ND-PublicOpening";
            rr:predicate epo:hasOpeningDateTime ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:OccurrenceDate) and exists(cbc:OccurrenceTime)) then cbc:OccurrenceDate || 'T' || cbc:OccurrenceTime else if(exists(cbc:OccurrenceDate)) then cbc:OccurrenceDate else null";
                    rr:datatype xsd:dateTime;
                ] ;
        ];
    rr:predicateObjectMap
        [
            # TODO min SDK 1.3 max SDK 1.3
            # TODO min SDK 1.4
            rdfs:label "BT-133-Lot";
            rdfs:comment "Public Opening Place of MG-OpeningTerm under ND-PublicOpening";
            rr:predicate epo:definesOpeningPlace ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Address-definesOpeningPlace-OpeningTerm-isSubjectToLotSpecificTerm-Lot_ND-PublicOpeningPlace ;
                    rr:joinCondition[
                        rr:child "path(..)";
                        rr:parent "path(../..)"
                    ];
                ] ;
        ]
.

tedm:MG-Address-definesOpeningPlace-OpeningTerm-isSubjectToLotSpecificTerm-Lot_ND-PublicOpeningPlace a rr:TriplesMap ;
    rdfs:label "MG-Address";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:OpenTenderEvent/cac:OccurenceLocation";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-PublicOpeningPlace";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_OpenTenderEventPlace_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw')}" ;
            rr:class  locn:Address
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-133-Lot";
            rdfs:comment "Public Opening Place of MG-Address under ND-PublicOpeningPlace";
            rr:predicate locn:fullAddress ;
            rr:objectMap
                [
                    rml:reference "cbc:Description";
                ] ;
        ]
.
tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-LotTenderingProcess a rr:TriplesMap ;
    rdfs:label "MG-SubmissionTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:comment "ND-LotTenderingProcess";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SubmissionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:SubmissionTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-17-Lot";
            rdfs:comment "SubmissionElectronic of MG-SubmissionTerm under ND-LotTenderingProcess";
            rr:predicate epo:hasESubmissionPermission ;
            rr:objectMap
                [
                    rdfs:label "permission:" ;
                    rr:parentTriplesMap tedm:permission;
                    rr:joinCondition [
                        rr:child "if(exists(cbc:SubmissionMethodCode[@listName='esubmission'])) then cbc:SubmissionMethodCode else null" ;
                        rr:parent "code.value" ;
                    ] ;
#                    rml:reference "if(exists(cbc:SubmissionMethodCode[@listName='esubmission'])) then cbc:SubmissionMethodCode else null";
                ] ;
        ];

.
tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-NoESubmission a rr:TriplesMap ;
    rdfs:label "MG-SubmissionTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess/cac:ProcessJustification";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-NoESubmission";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SubmissionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw')}" ;
            rr:class epo:SubmissionTerm
        ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.3 max SDK 1.7
            # TODO min SDK 1.8
            rdfs:label "BT-19-Lot";
            rdfs:comment "Submission Nonelectronic Justification of MG-SubmissionTerm under ND-NoESubmission";
            rr:predicate epo:hasNonElectronicSubmissionJustification ;
            rr:objectMap
                [
                    rdfs:label "at-voc:communication-justification" ;
                    rr:parentTriplesMap tedm:communication-justification ;
                    rr:joinCondition [
                        rr:child "cbc:ProcessReasonCode[@listName='no-esubmission-justification']";
                        rr:parent "code.value" ;
                    ] ;
#                    rml:reference "cbc:ProcessReasonCode[@listName='no-esubmission-justification']";
                ] ;
        ];
 rr:predicateObjectMap
        [
            # TODO min SDK 1.3 max SDK 1.7
            # TODO min SDK 1.8
            rdfs:label "BT-745-Lot";
            rdfs:comment "Submission Nonelectronic Description of MG-SubmissionTerm under ND-NoESubmission";
            rr:predicate epo:hasNonElectronicSubmissionDescription ;
            rr:objectMap
                [
                    rml:reference "cbc:Description";
                ] ;
        ]
.

tedm:MG-AdHocChannel-usesChannel-Lot_ND-LotTenderingProcessExtension a rr:TriplesMap ;
    rdfs:label "MG-AdHocChannel";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotTenderingProcessExtension";
            rml:reference "if (exists(descendant::efbc:AccessToolName) or exists(cbc:AccessToolsURI)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_Channel_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
            rr:class epo:AdHocChannel
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-632-Lot";
            rdfs:comment "Tool Name of MG-AdHocChannel underND-LotTenderingProcessExtension";
            rr:predicate dct:description  ;
            rr:objectMap
                [
                    rml:reference "descendant::efbc:AccessToolName";
                ] ;
        ]

.
tedm:MG-AdHocChannel-usesChannel-Lot_ND-LotTenderingProcess a rr:TriplesMap ;
    rdfs:label "MG-AdHocChannel";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingProcess";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotTenderingProcess";
            rml:reference "if (exists(descendant::efbc:AccessToolName) or exists(cbc:AccessToolsURI)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_Channel_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
            rr:class epo:AdHocChannel
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-124-Lot";
            rdfs:comment "Tool Atypical URL of MG-AdHocChannel underND-LotTenderingProcess";
            rr:predicate epo:hasAddressURL  ;
            rr:objectMap
                [
                    rml:reference "cbc:AccessToolsURI";
                    rr:datatype xsd:anyURI
                ] ;
        ]
.
tedm:MG-Fund-isFundedBy-Lot_ND-Funding a rr:TriplesMap ;
    rdfs:label "MG-Fund";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:Funding";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-Funding";
           rml:reference "if (exists(efbc:FinancingIdentifier)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_LotFund_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
#            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_Lot_{cbc:ID}" ;
#             rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_Funding_{efbc:FinancingIdentifier}" ;
            rr:class  epo:Fund
        ]  ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.9.1
            # TODO check the rferenence ar template and check the output
            rdfs:label "BT-7220-Lot";
            rdfs:comment "EUFundsProgramme of MG-Fund under ND-Funding";
            rr:predicate  epo:hasFundProgramme ;
            rr:objectMap
                [
                    rdfs:label "at-EU-programme" ;
                    rr:parentTriplesMap tedm:EU-programme ;
                    rr:joinCondition [
                        rr:child "cbc:FundingProgramCode" ;
                        rr:parent "code.value" ;
                    ] ;
#                   rml:reference "efac:Funding";

                ] ;
        ]   ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.9.1
            # TODO check the rferenence ar template and check the output
            rdfs:label "BT-6140-Lot";
            rdfs:comment "EUFundsDetails of MG-Fund under ND-Funding";
            rr:predicate  dct:description  ;
            rr:objectMap
                [
                   rml:reference "cbc:Description";
                   rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap  [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cbc:Description/@languageID" ]
                            ] ,
                            tedm:idlab-fn_executes_lookup ,
                            tedm:idlab-fn_inputFile_language ,
                            tedm:idlab-fn_fromColumn_0 ,
                            tedm:idlab-fn_toColumn_1
                        ]
                    ] ;

                ] ;
        ]   ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.9.1
            rdfs:label "BT-5010-Lot";
            rdfs:comment "EUFundsFinancingIdentifier of MG-Identifierunder ND-Funding";
            rr:predicate adms:identifier ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Identifier-identifier-Fund-isFundedBy-Lot_ND-Funding;
                ] ;
        ];
.
tedm:MG-Identifier-identifier-Fund-isFundedBy-Lot_ND-Funding a rr:TriplesMap ;
    rdfs:label "MG-Identifier";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:Funding";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            # TODO update the reference to include the ID
            rdfs:label "ND-Funding";
            rml:reference "if (exists(efbc:FinancingIdentifier)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_FundIdentifier_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
#            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_Funding_{efbc:FinancingIdentifier}" ;

            rr:class adms:Identifier
        ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.9.1
            # TODO check the rferenence ar template and check the output
            rdfs:label "BT-5010-Lot";
            rdfs:comment "EUFundsFinancingIdentifier of MG-Identifierunder ND-Funding";
            rr:predicate skos:notation ;
            rr:objectMap
                [
                    rml:reference "efbc:FinancingIdentifier";
                ] ;
        ];
.
tedm:MG-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SelectionCriteria a rr:TriplesMap ;
    rdfs:label "MG-SelectionCriterion";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:SelectionCriteria";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-SelectionCriteria";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SelectionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw')}" ;
            rr:class epo:SelectionCriterion
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-747-Lot";
            rdfs:comment "Selection Criteria Type of MG-SelectionCriterion under ND-SelectionCriteria";
            rr:predicate epo:hasSelectionCriterionType ;
            rr:objectMap
                [
                    rml:reference "cbc:CriterionTypeCode[@listName='selection-criterion']";
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-749-Lot";
            rdfs:comment "Selection Criteria Name of MG-SelectionCriterion under ND-SelectionCriteria";
            rr:predicate skos:prefLabel  ;
            rr:objectMap
                [
                    rml:reference "cbc:Name";
                    rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cbc:Name/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-750-Lot";
            rdfs:comment "Selection Criteria Description of MG-SelectionCriterion under ND-SelectionCriteria";
            rr:predicate dct:description ;
            rr:objectMap
                [
                    rml:reference "cbc:Description";
                    rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cbc:Description/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-748-Lot";
            rr:predicate epo:hasSelectionCriteriaUsage ;
            rr:objectMap
                [
                    rml:reference "cbc:CalculationExpressionCode[@listName='usage']";
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-40-Lot";
            rr:predicate epo:isUsedForCandidateRestriction;
            rr:objectMap
                [
                    rml:reference "efbc:SecondStageIndicator";
                    rr:datatype xsd:boolean;
                ] ;
        ];
     rr:predicateObjectMap
        [
            rdfs:label "BT-7532-Lot";
            rr:predicate epo:hasConstraint ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Constraint-hasConstraint-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SecondStageThresholdCriterionParameter ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(..)";
                    ];
                ] ;
        ];
rr:predicateObjectMap
        [
            rdfs:label "BT-5423-Lot";
            rr:predicate epo:hasConstraint ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Constraint-hasConstraint-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardThresholdCriterionParameter ;
                    rr:joinCondition [
                        rr:child "path(.)";
                        rr:parent "path(..)";
                    ];
                ] ;
        ]

.
tedm:MG-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SecondStageWeightCriterionParameter a rr:TriplesMap ;
    rdfs:label "MG-SelectionCriterion";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:SelectionCriteria/efac:CriterionParameter[efbc:ParameterCode/@listName='number-weight']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-SecondStageWeightCriterionParameter";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SelectionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:SelectionCriterion
        ] ;
    rr:predicateObjectMap
        [
            # TODO ro be added to source in previous test data is in AwardCriterionParameter not in CriterionParameter
            # TODO min SDK 1.9.1
            rdfs:label "BT-7531-Lot";
            rdfs:comment "Selection Criteria Second Stage Invite Number Weight of MG-SelectionCriterion under ND-SecondStageCriterionParameter";
            rr:predicate epo:hasWeightValueType ;
            rr:objectMap
                [
#                    rml:reference "if (exists(efbc:ParameterCode[@listName='number-weight'])) then(efbc:ParameterCode[@listName='number-weight']) else null";
#                    rml:reference "efbc:ParameterCode";
                   rdfs:label ":at-voc:number-weight" ;
                    rr:parentTriplesMap tedm:number-weight ;
                    rr:joinCondition [
                        rr:child "efbc:ParameterCode" ;
                        rr:parent "code.value" ;
                    ] ;
               ] ;
        ] ;
    rr:predicateObjectMap
        [
            #
            # TODO min SDK 1.9.1
            # TODO ro be added to source in previous test data is in AwardCriterionParameter not in CriterionParameter
            rdfs:label  "BT-752-Lot-WeightNumber";
            rdfs:comment "SelectionCriteriaSecondStageInviteThresholdNumber of MG-Constraint under ND-SecondStageThresholdCriterionParameter ";
            rr:predicate cccev:weight;
            rr:objectMap
                [
                    rml:reference "efbc:ParameterNumeric";
                    rr:datatype xsd:decimal;
                ] ;
        ]

.
#tedm:MG-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SecondStageCriterionParameter a rr:TriplesMap ;
#    rdfs:label "MG-SelectionCriterion";
#    rml:logicalSource
#        [
#            rml:source "data/source.xml" ;
#            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:SelectionCriteria/efac:CriterionParameter";
#            rml:referenceFormulation ql:XPath
#        ];
#    rr:subjectMap
#        [
#            rdfs:label "ND-SecondStageCriterionParameter";
#            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SelectionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
#            rr:class epo:SelectionCriterion
#        ] ;
#
#    rr:predicateObjectMap
#        [
#            rdfs:label "BT-7532-Lot";
#            rr:predicate epo:hasConstraint ;
#            rr:objectMap
#                [
#                    rr:parentTriplesMap tedm:MG-Constraint-hasConstraint-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SecondStageCriterionParameter ;
#                    rr:joinCondition [
#                        rr:child "path(.)";
#                        rr:parent "path(.)";
#                    ];
#                ] ;
#        ]
#.
tedm:MG-Constraint-hasConstraint-SelectionCriterion-specifiesProcurementCriterion-Lot_ND-SecondStageThresholdCriterionParameter a rr:TriplesMap ;
    rdfs:label "MG-Constraint";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:SelectionCriteria/efac:CriterionParameter[efbc:ParameterCode/@listName='number-threshold']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-SecondStageThresholdCriterionParameter";
            rml:reference "if (exists(efbc:ParameterCode[@listName='number-threshold'])) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_SelectionTermConstrain_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
            rr:class cccev:Constraint
        ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.3 max SDK 1.8
            #  TODO min SDK 1.9.1
            rdfs:label  "BT-7532-Lot";
            rdfs:comment "Selection Criteria Second Stage Invite Number of MG-Constraint under ND-SecondStageThresholdCriterionParameter";
            rr:predicate epo:hasThresholdType ;
            rr:objectMap
                [
                    rdfs:label "at-voc:number-threshold" ;
                    rr:parentTriplesMap tedm:number-threshold ;
                    rr:joinCondition [
                        rr:child "efbc:ParameterCode" ;
                        rr:parent "code.value"
                    ] ;
               ] ;
                ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.3 max SDK 1.8
            #  TODO min SDK 1.9.1
            rdfs:label  "BT-752-Lot";
            rdfs:comment "SelectionCriteriaSecondStageInviteThresholdNumber of MG-Constraint under ND-SecondStageThresholdCriterionParameter ";
            rr:predicate epo:hasThresholdValue ;
            rr:objectMap
                [
                    rml:reference "efbc:ParameterNumeric";
                    rr:datatype xsd:decimal;
                ] ;
        ]
.
tedm:MG-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardCriterion a rr:TriplesMap ;
    rdfs:label "MG-AwardCriterion";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms/cac:AwardingCriterion/cac:SubordinateAwardingCriterion";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotAwardCriterion";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_AwardCriterion_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw')}" ;
            rr:class epo:AwardCriterion
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-539-Lot";
            rdfs:comment "Award Criterion Type of MG-AwardCriterion under ND-LotAwardCriterion ";
            rr:predicate epo:hasAwardCriterionType ;
            rr:objectMap
                [
                     rdfs:label "at-voc:award-criterion-type" ;
                    rr:parentTriplesMap tedm:award-criterion-type ;
                    rr:joinCondition [
                        rr:child "if(exists(cbc:AwardingCriterionTypeCode[@listName='award-criterion-type'])) then cbc:AwardingCriterionTypeCode[@listName='award-criterion-type'] else null" ;
                        rr:parent "code.value"
                    ] ;
#                    rml:reference "if(exists(cbc:AwardingCriterionTypeCode[@listName='award-criterion-type'])) then cbc:AwardingCriterionTypeCode[@listName='award-criterion-type'] else null";
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-540-Lot";
            rdfs:comment "Award Criterion Description of of MG-AwardCriterion under ND-LotAwardCriterion";
            rr:predicate dct:description;
            rr:objectMap
                [
                    rml:reference "if(exists(descendant::cbc:Description)) then cbc:Description else null";
                    rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cbc:Description/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-734-Lot";
            rr:predicate  skos:prefLabel  ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:Name)) then cbc:Name else null";
                    rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cbc:Description/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ]
.

tedm:MG-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardWeightCriterionParameter a rr:TriplesMap ;
    rdfs:label "MG-AwardCriterion";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms/cac:AwardingCriterion/cac:SubordinateAwardingCriterion/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:AwardCriterionParameter[efbc:ParameterCode/@listName='number-weight']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
                rdfs:label "ND-LotAwardWeightCriterionParameter";

            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_AwardCriterion_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:AwardCriterion
        ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.8
            # TODO min SDK 1.3 and Max SDK 1.7
            rdfs:label "BT-541-Lot-WeightNumber";
            rdfs:comment "AwardCriterionWeightNumber of MG-AwardCriterion under ND-LotAwardWeightCriterionParameter";
            rr:predicate  cccev:weight ;
            rr:objectMap
                [
                    rml:reference "if(exists(descendant::efbc:ParameterNumeric)) then descendant::efbc:ParameterNumeric else null";
                    rr:datatype xsd:decimal;
                ] ;
        ];
     rr:predicateObjectMap
        [
            # TODO min SDK 1.8
            # TODO min SDK 1.3 and Max SDK 1.7
            rdfs:label "BT-5421-Lot";
            rdfs:comment "Award Criterion Number Weight of MG-AwardCriterion under ND-LotAwardWeightCriterionParameter";
            rr:predicate epo:hasWeightValueType ;
            rr:objectMap
                [
#                    rml:reference "if (exists(efbc:ParameterCode[@listName='number-weight'])) then(efbc:ParameterCode[@listName='number-weight']) else null";
#                    rml:reference "efbc:ParameterCode";
                   rdfs:label ":at-voc:number-weight" ;
                    rr:parentTriplesMap tedm:number-weight ;
                    rr:joinCondition [
                        rr:child "if(exists(descendant::efbc:ParameterNumeric)) then descendant:: efbc:ParameterCode else null" ;
                        rr:parent "code.value" ;
                    ] ;
               ] ;
        ] ;
.

tedm:MG-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardFixedCriterionParameter a rr:TriplesMap ;
    rdfs:label "MG-AwardCriterion";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms/cac:AwardingCriterion/cac:SubordinateAwardingCriterion/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:AwardCriterionParameter[efbc:ParameterCode/@listName='number-fixed']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
                rdfs:label "ND-LotAwardFixedCriterionParameter";

            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_AwardCriterion_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:AwardCriterion
        ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.8
            #TODO there is no values in resource TBA
            rdfs:label "BT-541-Lot-FixedNumber";
            rdfs:comment "AwardCriterionFixedNumberof MG-AwardCriterion under ND-LotAwardFixedCriterionParameter";
            rr:predicate  epo:hasFixedValue ;
            rr:objectMap
                [
                    rml:reference "if(exists(descendant::efbc:ParameterNumeric)) then descendant::efbc:ParameterNumeric else null";
                    rr:datatype xsd:decimal;
                ] ;
        ];
     rr:predicateObjectMap
        [
            # TODO min SDK 1.8
            # TODO min SDK 1.3 and Max SDK 1.7
            #TODO there is no values in resource TBA
            rdfs:label "BT-5422-Lot";
            rdfs:comment "Award Criterion Number Fixed of MG-AwardCriterion under ND-LotAwardFixedCriterionParameter";
            rr:predicate epo:hasFixedValueType ;
            rr:objectMap
                [
#                    rml:reference "if (exists(efbc:ParameterCode[@listName='number-weight'])) then(efbc:ParameterCode[@listName='number-weight']) else null";
#                    rml:reference "efbc:ParameterCode";
                   rdfs:label ":at-voc:number-fixed" ;
                    rr:parentTriplesMap tedm:number-fixed ;
                    rr:joinCondition [
                        rr:child "if(exists(descendant::efbc:ParameterNumeric)) then descendant:: efbc:ParameterCode else null" ;
                        rr:parent "code.value" ;
                    ] ;
               ] ;
        ] ;
.

tedm:MG-Constraint-hasConstraint-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardThresholdCriterionParameter a rr:TriplesMap ;
    rdfs:label "MG-Constraint";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms/cac:AwardingCriterion/cac:SubordinateAwardingCriterion/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:AwardCriterionParameter[efbc:ParameterCode/@listName='number-threshold']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotAwardThresholdCriterionParameter";
            rml:reference "if (exists(efbc:ParameterCode[@listName='number-threshold'])) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_SelectionTermConstrain_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
            rr:class cccev:Constraint
        ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.3 max SDK 1.8
            #  TODO min SDK 1.9.1
            #TODO to be added to resource. it is even not in existing data
            rdfs:label  "BT-5423-Lot";
            rdfs:comment "Award Criterion Number Threshold of MG-Constraint under ND-LotAwardThresholdCriterionParameter";
            rr:predicate epo:hasThresholdType ;
            rr:objectMap
                [
                    rdfs:label "at-voc:number-threshold" ;
                    rr:parentTriplesMap tedm:number-threshold ;
                    rr:joinCondition [
                        rr:child "efbc:ParameterCode" ;
                        rr:parent "code.value"
                    ] ;
               ] ;
            ] ;
.

tedm:MG-AwardCriterion-specifiesProcurementCriterion-Lot_ND-LotAwardCriteria a rr:TriplesMap ;
    rdfs:label "MG-AwardCriterion";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms/cac:AwardingCriterion";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotAwardCriteria";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_AwardCriterion_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(ancestor::node()[7])) || '?response_type=raw')}" ;
            rr:class epo:AwardCriterion
        ] ;
   rr:predicateObjectMap
        [
            # TODO to be added to resource
            rdfs:label "BT-543-Lot";
            rdfs:comment " Award Criteria Complicated of G-AwardCriterion under ND-LotAwardCriteria ";
            rr:predicate epo:hasAwardCriteriaEvaluationFormula  ;
            rr:objectMap
                [
                    rml:reference "if(exists(cbc:CalculationExpression)) then cbc:CalculationExpression else null";

                ] ;
        ] ;
.

tedm:MG-AwardEvaluationTerm-isSubjectToLotSpecificTerm-Lot_ND-LotAwardCriteria a rr:TriplesMap ;
    rdfs:label "MG-AwardEvaluationTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms/cac:AwardingCriterion";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LotAwardCriteria";
            rml:reference "if(exists(cbc:Description)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_AwardEvaluationTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
            rr:class epo:AwardEvaluationTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-733-Lot";
            rdfs:comment "Award Criteria Order Justification of MG-AwardEvaluationTerm under ND-LotAwardCriteria";
            rr:predicate epo:hasAwardCriteriaOrderJustification ;
            rr:objectMap
                [
                    rml:reference "cbc:Description";
                    rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cbc:Description/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ]
.

tedm:MG-MultipleStageProcedureTerm-isSubjectToLotSpecificTerm-Lot_ND-AwardingTerms a rr:TriplesMap ;
    rdfs:label "MG-MultipleStageProcedureTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label  "ND-AwardingTerms";
            rml:reference "if(exists(cbc:NoFurtherNegotiationIndicator)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_MultipleStageProcedureTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw') else null" ;
            rr:class epo:MultipleStageProcedureTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-120-Lot";
            rdfs:comment "No Negotiation Necessary of MG-MultipleStageProcedureTerm under ND-AwardingTerms";
            rr:predicate epo:hasNoNegotiationNecessary ;
            rr:objectMap
                [
                    rml:reference "cbc:NoFurtherNegotiationIndicator";
                    rr:datatype xsd:boolean;
                ] ;
        ]
.

tedm:MG-ContractTerm-foreseesContractSpecificTerm-Lot_ND-TendererLegalForm a rr:TriplesMap ;
    rdfs:label "MG-ContractTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:TendererQualificationRequest[not(cac:SpecificTendererRequirement)]";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label  "ND-TendererLegalForm";
            rml:reference "if(exists(cbc:CompanyLegalForm)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_AwardEvaluationTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path()) || '?response_type=raw') else null" ;
            rr:class  epo:ContractTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-76-Lot";
            rdfs:comment "Tenderer Legal Form Description of MG-ContractTerm under ND-TendererLegalForm";
            rr:predicate epo:hasLegalFormRequirement ;
            rr:objectMap
                [
                    rml:reference "cbc:CompanyLegalForm";
                    rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cbc:CompanyLegalForm/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ]
.

tedm:MG-DesignContestRegimeTerm-isSubjectToLotSpecificTerm-Lot_ND-AwardingTerms a rr:TriplesMap ;
    rdfs:label "MG-DesignContestRegimeTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label  "ND-AwardingTerms";
#            rml:reference "if(exists(cbc:FollowupContractIndicator)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_DesignContestRegimeTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw') else null" ;
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_DesignContestRegimeTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:DesignContestRegimeTerm
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-41-Lot";
            rdfs:comment "FollowingContract of MG-DesignContestRegimeTerm under ND-AwardingTerms";
            rr:predicate epo:hasFollowupContract  ;
            rr:objectMap
                [
                    rml:reference "cbc:FollowupContractIndicator";
                    rr:datatype xsd:boolean;
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-42-Lot";
            rdfs:comment "JuryDecisionBinding of MG-DesignContestRegimeTerm under ND-AwardingTerms";
            rr:predicate epo:isJuryDecisionBinding   ;
            rr:objectMap
                [
                    rml:reference "cbc:BindingOnBuyerIndicator";
                    rr:datatype xsd:boolean;
                ] ;
        ];
     rr:predicateObjectMap
        [
            rdfs:label "BT-44-Lot";
            rdfs:comment "Prize rank of MG-DesignContestRegimeTerm under ND-AwardingTerms";
            rr:predicate epo:definesPrize  ;
            rr:objectMap
                [
                    rr:parentTriplesMap tedm:MG-Prize-definesPrize-DesignContestRegimeTerm-isSubjectToLotSpecificTerm-Lot_ND-Prize ;
                    rr:joinCondition[
                        rr:child "path(.)";
                        rr:parent "path(..)"
                    ];
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-45-Lot";
            rdfs:comment "RewardsOther of MG-DesignContestRegimeTerm under ND-Prize";
            rr:predicate  epo:hasFollowupContractInformation ;

            rr:objectMap
                [
                   rml:reference "cac:Prize/cbc:Description";
                   rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cac:Prize/cbc:Description/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ];

.

tedm:MG-Prize-definesPrize-DesignContestRegimeTerm-isSubjectToLotSpecificTerm-Lot_ND-Prize a rr:TriplesMap ;
    rdfs:label "MG-Prize";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms/cac:Prize";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label  "ND-Prize";
#            rml:reference "if(exists(cbc:FollowupContractIndicator)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_DesignContestRegimeTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw') else null" ;
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_Prize_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:Prize
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-44-Lot";
            rdfs:comment "PrizeRank of MG-Prize under ND-Prize";
            rr:predicate  epo:hasPrizeRank;

            rr:objectMap
                [
                    rml:reference "cbc:RankCode";
                   rr:datatype xsd:integer;
                ] ;
        ];
    rr:predicateObjectMap
        [
            rdfs:label "BT-644-Lot";
            rdfs:comment "PrizeValue of MG-Prize under ND-Prize";
            rr:predicate  epo:hasPrizeValue ;

            rr:objectMap
                [
                   rr:parentTriplesMap tedm:MG-MonetaryValue-hasPrizeValue-Prize-definesPrize-DesignContestRegimeTerm-isSubjectToLotSpecificTerm-Lot_ND-Prize ;
                    rr:joinCondition[
                        rr:child "path(.)";
                        rr:parent "path(.)"
                    ];
                ] ;
        ];
.

tedm:MG-MonetaryValue-hasPrizeValue-Prize-definesPrize-DesignContestRegimeTerm-isSubjectToLotSpecificTerm-Lot_ND-Prize a rr:TriplesMap ;
    rdfs:label "MG-MonetaryValue";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:AwardingTerms/cac:Prize";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label  "ND-Prize";
#            rml:reference "if(exists(cbc:FollowupContractIndicator)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_DesignContestRegimeTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw') else null" ;
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_MonetaryValue_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:MonetaryValue
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-644-Lot";
            rdfs:comment "PrizeValue of MG-MonetaryValue under ND-Prize";
            rr:predicate  epo:hasAmountValue ;

            rr:objectMap
                [
                   rml:reference "cbc:ValueAmount";
                   rr:datatype xsd:decimal;
                ] ;
        ];
.

tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-LateTendererInformation a rr:TriplesMap ;
    rdfs:label "MG-SubmissionTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:TendererQualificationRequest[not(cbc:CompanyLegalFormCode)]/cac:SpecificTendererRequirement[not(cbc:TendererRequirementTypeCode[@listName='reserved-procurement'])]";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label "ND-LateTendererInformation";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SubmissionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(ancestor::node()[3])) || '?response_type=raw')}" ;
            rr:class epo:SubmissionTerm
        ] ;
    rr:predicateObjectMap
        [
            # TODO min SDK 1.3 max SDK 1.7
            #  TODO min SDK 1.8
            rdfs:label "BT-772-Lot";
            rdfs:comment "Late Tenderer Information of MG-SubmissionTerm under ND-LateTendererInformation";
            rr:predicate epo:hasLateSubmissionInformationDescription;
            rr:objectMap
                [
                    rml:reference "descendant::cbc:Description";
                    rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || descendant::cbc:Description/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ] ;
    rr:predicateObjectMap
        [
           # TODO min SDK 1.3 max SDK 1.7
           # TODO min SDK 1.8
            rdfs:label "BT-771-Lot";
            rr:predicate epo:hasLateSubmissionPermission;
            rr:objectMap
                [
                     rdfs:label "at-voc:framework-agreement" ;
                    rr:parentTriplesMap tedm:missing-info-submission ;
                    rr:joinCondition [
                        rr:child "descendant::cbc:TendererRequirementTypeCode[@listName='missing-info-submission']";
                        rr:parent "code.value" ;
                    ] ;
#                    rml:reference "descendant::cbc:TendererRequirementTypeCode[@listName='missing-info-submission']";
                ] ;
        ]
.

tedm:MG-ParticipationCondition-specifiesProcurementCriterion-Lot_ND-LotReservedParticipation a rr:TriplesMap ;
    rdfs:label "MG-ParticipationCondition";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms/cac:TendererQualificationRequest[not(cbc:CompanyLegalFormCode)][not(cac:SpecificTendererRequirement/cbc:TendererRequirementTypeCode[@listName='missing-info-submission'])]/cac:SpecificTendererRequirement[cbc:TendererRequirementTypeCode/@listName='reserved-procurement']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:label  "ND-LotReservedParticipation";
#            rml:reference "if(exists(cbc:FollowupContractIndicator)) then 'http://data.europa.eu/a4g/resource/id_' || replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-') || '_DesignContestRegimeTerm_' || unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(../..)) || '?response_type=raw') else null" ;
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_ParticipationCondition_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:ParticipationCondition
        ] ;
    rr:predicateObjectMap
        [
           # TODO min SDK 1.4 max SDK 1.7
           # TODO min SDK 1.8
           # TODO min SDK 1.3 max SDK 1.3
            rdfs:label "BT-71-Lot";
            rdfs:comment "Reserved Participation of MG-ParticipationCondition under ND-LotReservedParticipation";
            rr:predicate  epo:hasReservedProcurement  ;

            rr:objectMap
                [
#                   rml:reference "cbc:TendererRequirementTypeCode";
                   rdfs:label "at-voc:reserved-procurement" ;
                    rr:parentTriplesMap tedm:reserved-procurement ;
                    rr:joinCondition [
                        rr:child "cbc:TendererRequirementTypeCode";
                        rr:parent "code.value" ;
                    ] ;
                ] ;
        ];
  .

tedm:MG-SubmissionTerm-isSubjectToLotSpecificTerm-Lot_ND-LotTenderingTerms a rr:TriplesMap ;
    rdfs:label "MG-SubmissionTerm";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
            rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']/cac:TenderingTerms";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:comment "ND-LotTenderingTerms";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SubmissionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:SubmissionTerm
        ] ;
      rr:predicateObjectMap
        [
            rdfs:label "BT-63-Lot";
            rdfs:comment "Variants of MG-SubmissionTerm under ND-LotTenderingTerms";
            rr:predicate epo:hasVariantPermission ;
            rr:objectMap
                [
#                    rml:reference "cbc:VariantConstraintCode";
                    rdfs:label "at-voc:permission" ;
                    rr:parentTriplesMap tedm:permission ;
                    rr:joinCondition [
                        rr:child "cbc:VariantConstraintCode";
                        rr:parent "code.value" ;
                    ] ;
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-769-Lot";
            rdfs:comment "Multiple Tenders of MG-SubmissionTerm under ND-LotTenderingTerms";
            rr:predicate epo:isMultipleTenderSubmissionAllowed ;
            rr:objectMap
                [
                    rml:reference "cbc:MultipleTendersCode";
                    rr:datatype xsd:boolean;
                ] ;
        ];
.

tedm:MG-Lot_ND-LotTenderingTerms a rr:TriplesMap ;
    rdfs:label "MG-Lot";
    rml:logicalSource
        [
            rml:source "data/source.xml" ;
             rml:iterator "/*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Lot']";
            rml:referenceFormulation ql:XPath
        ];
    rr:subjectMap
        [
            rdfs:comment "ND-LotTenderingTerms";
            rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_Lot_{cbc:ID}" ;
#           rr:template "http://data.europa.eu/a4g/resource/id_{replace(replace(/*/cbc:ID[@schemeName='notice-id'], ' ', '-' ), '/' , '-')}_SubmissionTerm_{unparsed-text('https://digest-api.ted-data.eu/api/v1/hashing/fn/uuid/' || encode-for-uri(path(..)) || '?response_type=raw')}" ;
            rr:class epo:Lot
        ] ;
      rr:predicateObjectMap
        [
            rdfs:label "BT-94-Lot";
            rdfs:comment "Recurrence MG-Lot under ND-LotTenderingTerms";
            rr:predicate epo:isRecurrent  ;
            rr:objectMap
                [
                    rml:reference "cac:TenderingTerms/cbc:RecurringProcurementIndicator";
                    rr:datatype xsd:boolean
                ] ;
        ] ;
    rr:predicateObjectMap
        [
            rdfs:label "BT-95-Lot";
            rdfs:comment "Recurrence Description MG-Lot under ND-LotTenderingTerms";
            rr:predicate epo:hasRecurrenceDescription   ;
            rr:objectMap
                [
                    rml:reference "cac:TenderingTerms/cbc:RecurringProcurementDescription";
                    rml:languageMap [
                        fnml:functionValue [
                            rr:predicateObjectMap [
                                rr:predicate idlab-fn:str ;
                                rr:objectMap [ rml:reference "'http://publications.europa.eu/resource/authority/language/' || cac:TenderingTerms/cbc:RecurringProcurementDescription/@languageID" ]
                                ] ,
                                tedm:idlab-fn_executes_lookup ,
                                tedm:idlab-fn_inputFile_language ,
                                tedm:idlab-fn_fromColumn_0 ,
                                tedm:idlab-fn_toColumn_1
                        ]
                    ] ;
                ] ;
        ] ;
.